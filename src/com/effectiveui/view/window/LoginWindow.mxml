<?xml version="1.0" encoding="utf-8"?>
<mx:Window xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="450" height="200" creationComplete="init()">
	<mx:VBox left="30" top="20" verticalGap="12">
		<mx:Text text="Username:"/>
		<mx:Text text="Password:"/>
		<mx:Text text="Server URL:"/>
	</mx:VBox>
	<mx:VBox left="100" top="20">
		<mx:TextInput id="uname"/>
		<mx:TextInput id="pass" displayAsPassword="true"/>
		<mx:TextInput text="https://effectiveui-trac.cvsdude.com/ebay_Desktop" id="serverURL" />
	</mx:VBox>	
	<mx:Button label="Submit" click="login()" bottom="30" horizontalCenter="0"/>
	<mx:Script>
		<![CDATA[
			import com.effectiveui.event.GetOwnersEvent;
			import com.effectiveui.event.GetTypesEvent;
			import com.effectiveui.event.GetVersionsEvent;
			import com.effectiveui.event.GetStatusesEvent;
			import com.effectiveui.event.GetResolutionsEvent;
			import com.effectiveui.event.GetPrioritiesEvent;
			import com.effectiveui.event.GetComponentsEvent;
			import com.effectiveui.event.GetMilestonesEvent;
			import com.effectiveui.event.GetTicketsEvent;
			import com.effectiveui.model.TracModel;
			
			private function init():void{
				addEventListener(KeyboardEvent.KEY_DOWN, handleKeyDown);
				this.focusManager.setFocus(uname);
			}
			
			private var model:TracModel = TracModel.getInstance();
		
			private function login():void{
				model.username = uname.text;
				model.password = pass.text;
				model.serverURL = serverURL.text.replace("https://", "").replace("http://", "");				
				
				new GetTicketsEvent().dispatch();				
				new GetMilestonesEvent().dispatch();
				new GetComponentsEvent().dispatch();
				new GetPrioritiesEvent().dispatch();
				new GetResolutionsEvent().dispatch();
				new GetStatusesEvent().dispatch();
				new GetVersionsEvent().dispatch();
				new GetTypesEvent().dispatch();
				new GetOwnersEvent().dispatch();
				
				removeEventListener(KeyboardEvent.KEY_DOWN, handleKeyDown);
				close();
			}
			
			private function handleKeyDown(event:KeyboardEvent):void{
				if(event.keyCode == Keyboard.ENTER){
					login();
				}
			}
		]]>
	</mx:Script>
</mx:Window>
